/* =========================
   Librēth’s Shell — style.css
   ========================= */

/* page base */
html, body { height: 100%; }
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: "Courier New", Courier, monospace;
  font-size: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* shared container */
.screen {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 2rem;
  flex-direction: column;
}

/* pre block formatting */
#loading-screen pre,
.screen pre {
  white-space: pre-wrap;
  max-width: 900px;
  width: 100%;
  margin: 0 auto;
  font-size: 1.5em;
  text-align: center;
}

/* blinking cursor */
.blinker { animation: blink 1s step-start infinite; }
@keyframes blink { 50% { opacity: 0; } }

/* reveal/hide (CSS fallback if JS is off) */
#loading-screen {
  opacity: 1;
  pointer-events: auto;
  animation: fadeOut 0.9s ease forwards;
  animation-delay: 4s; /* boot duration */
}
#entry {
  opacity: 0;
  pointer-events: none;
  display: flex;
  animation: fadeIn 0.9s ease forwards;
  animation-delay: 4s; /* show after boot */
}
@keyframes fadeOut {
  to { opacity: 0; pointer-events: none; filter: blur(1px); }
}
@keyframes fadeIn {
  to { opacity: 1; pointer-events: auto; }
}

/* clickable word */
.linkword {
  font-size: 2rem;
  opacity: 0.8;
  transition: opacity 0.25s ease, text-shadow 0.25s ease, transform 0.25s ease;
  cursor: pointer;
  user-select: none;
  text-align: center;
}
.linkword:hover {
  opacity: 1;
  text-shadow: 0 0 8px rgba(204, 153, 255, 0.9);
  transform: translateZ(0);
}

/* responsive niceties */
@media (max-width: 600px) {
  body { font-size: 14px; }
  .linkword { font-size: 1.6rem; }
}

/* --- animated boot sequence (works with or without JS) --- */
.boot .line { opacity: 0; transform: translateY(4px); }
.boot .line.revealed {
  opacity: 1; transform: none;
  transition: opacity .25s ease, transform .25s ease;
}
/* typewriter caret for lines being typed */
.boot .line.typing::after {
  content: "█";
  margin-left: 4px;
  animation: blink 1s step-start infinite;
}
/* animated "..." */
.dots::after { content: ""; animation: dots 1.1s steps(3,end) infinite; }
@keyframes dots {
  0% { content:"" } 33% { content:"." } 66% { content:".." } 100% { content:"..." }
}

/* progress bar + hint */
.progress {
  position: absolute; bottom: 10vh;
  width: min(60ch, 70%); height: 4px;
  background: #222; border-radius: 2px; overflow: hidden; opacity: .9;
}
.progress > span { display:block; height:100%; width:0%; background: rgba(204,153,255,.9); }
.hint {
  position: absolute; bottom: 6vh;
  font-size: .9em; opacity: .5; text-align:center; width:100%;
}

/* ----- CRT scanlines + vignette overlay (stronger & on top) ----- */
.scanlines {
  position: fixed; inset: 0;
  z-index: 9999;                 /* ensure it sits above everything */
  pointer-events: none;
  /* thicker pattern for HiDPI: 2px bright + 6px gap */
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.05) 0px,
      rgba(255,255,255,0.05) 2px,
      rgba(0,0,0,0) 8px
    );
  /* soft vignette */
  box-shadow:
    inset 0 0 120px rgba(0,0,0,0.65),
    inset 0 0 40px rgba(0,0,0,0.5);
  /* start with normal blending so it’s clearly visible; switch to overlay if desired */
  mix-blend-mode: normal;
  opacity: 0.5;                  /* bump as needed (0.35–0.6) */
  animation: crt-flicker 7s ease-in-out infinite;
}
@keyframes crt-flicker {
  0%,100% { opacity: 0.5; }
  10%     { opacity: 0.46; }
  22%     { opacity: 0.54; }
  35%     { opacity: 0.47; }
  48%     { opacity: 0.52; }
  62%     { opacity: 0.44; }
  75%     { opacity: 0.55; }
  88%     { opacity: 0.49; }
}

/* gentle global flicker on the boot screen text */
#loading-screen .boot { animation: text-flicker 6s ease-in-out infinite; }
@keyframes text-flicker {
  0%,100% { filter: none; }
  40%     { filter: contrast(1.05) brightness(1.03); }
  70%     { filter: contrast(0.98) brightness(0.98); }
}

/* ---------- GLITCH TEAR / JITTER (short burst; triggered by #loading-screen.tear) ---------- */
#loading-screen.tear {
  animation: tear-shift 0.18s ease-in-out 1, tear-skew 0.18s ease-in-out 1;
  will-change: transform, filter;
  filter: contrast(1.1) brightness(1.03);
}
@keyframes tear-shift {
  0% { transform: translateX(0) }
  20% { transform: translateX(-2px) }
  40% { transform: translateX(3px) }
  60% { transform: translateX(-3px) }
  80% { transform: translateX(2px) }
  100% { transform: translateX(0) }
}
@keyframes tear-skew {
  0% { transform: skewX(0deg) }
  40% { transform: skewX(0.6deg) }
  70% { transform: skewX(-0.6deg) }
  100% { transform: skewX(0deg) }
}
/* horizontal band accents during the tear */
#loading-screen.tear .boot { position: relative; }
#loading-screen.tear .boot::before,
#loading-screen.tear .boot::after {
  content: "";
  position: absolute; left: 0; right: 0; height: 6px;
  background: linear-gradient(90deg,
    rgba(204,153,255,0.35), rgba(255,255,255,0.15), rgba(204,153,255,0.35)
  );
  opacity: 0.6; filter: blur(0.4px);
}
#loading-screen.tear .boot::before { top: 22%; }
#loading-screen.tear .boot::after  { top: 64%; }

/* ---------- FLASH ON REVEAL (toggle .flash.go) ---------- */
.flash {
  position: fixed; inset: 0;
  z-index: 10000;               /* above scanlines */
  pointer-events: none;
  background:
    radial-gradient(ellipse at center, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.0) 60%),
    rgba(255,255,255,0.0);
  opacity: 0;
}
.flash.go { animation: flash-pop 180ms ease-out 1; }
@keyframes flash-pop {
  0% { opacity: 0; }
  15% { opacity: 1; }
  100% { opacity: 0; }
}

/* accessibility */
@media (prefers-reduced-motion: reduce) {
  .boot .line { transition: none; }
  .blinker, .dots::after { animation: none !important; }
  .scanlines, #loading-screen .boot { animation: none; }
  #loading-screen.tear { animation: none; }
  .flash.go { animation: none; opacity: 0; }
}

/* ========= optional: body overlay fallback (commented) =========
body::before {
  content: "";
  position: fixed; inset: 0; z-index: 9998; pointer-events: none;
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.05) 0 2px,
      rgba(0,0,0,0) 2px 8px
    );
  box-shadow:
    inset 0 0 120px rgba(0,0,0,0.65),
    inset 0 0 40px rgba(0,0,0,0.5);
  animation: crt-flicker 7s ease-in-out infinite;
}
*/
/* Global scanlines overlay on every page */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 9998;                 /* under .flash (10000), above everything else */
  pointer-events: none;

  /* thicker pattern for HiDPI visibility */
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.05) 0 2px,
      rgba(0,0,0,0) 2px 8px
    );

  /* soft vignette */
  box-shadow:
    inset 0 0 120px rgba(0,0,0,0.65),
    inset 0 0 40px rgba(0,0,0,0.5);

  animation: crt-flicker 7s ease-in-out infinite;
}

/* keep these keyframes you already have */
@keyframes crt-flicker {
  0%,100% { opacity: 0.5; }
  10%     { opacity: 0.46; }
  22%     { opacity: 0.54; }
  35%     { opacity: 0.47; }
  48%     { opacity: 0.52; }
  62%     { opacity: 0.44; }
  75%     { opacity: 0.55; }
  88%     { opacity: 0.49; }
}

/* respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  body::before { animation: none; }
}
